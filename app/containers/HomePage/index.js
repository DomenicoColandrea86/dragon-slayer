/*
 * HomePage
 *
 * This is the first thing users see of our App, at the '/' route
 */

import React from 'react';
import PropTypes from 'prop-types';
import { Helmet } from 'react-helmet';
import { FormattedMessage } from 'react-intl';
import { connect } from 'react-redux';
import { compose } from 'redux';
import { createStructuredSelector } from 'reselect';
import Select from 'react-select';

import injectReducer from 'utils/injectReducer';
import injectSaga from 'utils/injectSaga';
import {
  makeSelectRepos,
  makeSelectLoading,
  makeSelectError,
} from 'containers/App/selectors';
import H2 from 'components/H2';
import ReposList from 'components/ReposList';
import LineBarChart from 'components/LineBarChart';
import AtPrefix from './AtPrefix';
import CenteredSection from './CenteredSection';
import Form from './Form';
import Input from './Input';
import Section from './Section';
import messages from './messages';
import { loadRepos } from '../App/actions';
import { changeUsername } from './actions';
import { makeSelectUsername } from './selectors';
import reducer from './reducer';
import saga from './saga';

/* eslint-disable react/prefer-stateless-function */
export class HomePage extends React.PureComponent {
  /**
   * when initial state username is not null, submit the form to load repos
   */
  componentDidMount() {
    if (this.props.username && this.props.username.trim().length > 0) {
      this.props.onSubmitForm();
    }
  }

  render() {
    const { loading, error, repos } = this.props;
    const reposListProps = {
      loading,
      error,
      repos,
    };

    const data = [
      {
        dataType: 'VO2',
        currency: 'USD',
        currencySymbol: '$',
        name: 'NYC Metro Office Volume ($)',
        ticker: 'NYCMET_OFF',
        lookupname: 'NYC Metro Office Volume ($)',
        fullName: 'NYC Metro Office Volume ($).VO2.USD',
        type: 'line',
        yAxis: 0,
        color: '#EA7517',
        dashStyle: 'Solid',
        symbol: 'circle',
        values: [
          { a: 1009843200000.0, b: 6646642569.492 },
          { a: 1017619200000.0, b: 7112886867.7617 },
          { a: 1025481600000.0, b: 9490802335.425 },
          { a: 1033430400000.0, b: 9215149225.3962 },
          { a: 1041379200000.0, b: 10844933896.9945 },
          { a: 1049155200000.0, b: 9209591203.1662 },
          { a: 1057017600000.0, b: 10188281518.1207 },
          { a: 1064966400000.0, b: 10073680852.0554 },
          { a: 1072915200000.0, b: 11246898020.4571 },
          { a: 1080777600000.0, b: 14161054109.5297 },
          { a: 1088640000000.0, b: 13768751491.5332 },
          { a: 1096588800000.0, b: 14804925284.4236 },
          { a: 1104537600000.0, b: 14452162806.2929 },
          { a: 1112313600000.0, b: 17871472236.4702 },
          { a: 1120176000000.0, b: 17688547806.8489 },
          { a: 1128124800000.0, b: 18921020068.0476 },
          { a: 1136073600000.0, b: 20664604312.3002 },
          { a: 1143849600000.0, b: 18524414262.4832 },
          { a: 1151712000000.0, b: 20869512415.8874 },
          { a: 1159660800000.0, b: 26931637794.7595 },
          { a: 1167609600000.0, b: 44549720533.251 },
          { a: 1175385600000.0, b: 50509504129.6153 },
          { a: 1183248000000.0, b: 52457179943.1188 },
          { a: 1191196800000.0, b: 50870685538.1077 },
          { a: 1199145600000.0, b: 31556785641.2659 },
          { a: 1207008000000.0, b: 26671271517.4467 },
          { a: 1214870400000.0, b: 24288487923.8723 },
          { a: 1222819200000.0, b: 17488552723.9519 },
          { a: 1230768000000.0, b: 15569549439.7531 },
          { a: 1238544000000.0, b: 9749662374.8484 },
          { a: 1246406400000.0, b: 4945352199.8484 },
          { a: 1254355200000.0, b: 3071383663.5728 },
          { a: 1262304000000.0, b: 2776327140.3333 },
          { a: 1270080000000.0, b: 4691322516.6638 },
          { a: 1277942400000.0, b: 5998712895.1837 },
          { a: 1285891200000.0, b: 10947595918.0147 },
          { a: 1293840000000.0, b: 11841118873.8504 },
          { a: 1301616000000.0, b: 14258588963.4249 },
          { a: 1309478400000.0, b: 17700342714.2831 },
          { a: 1317427200000.0, b: 17734904004.8507 },
          { a: 1325376000000.0, b: 18940452595.0486 },
          { a: 1333238400000.0, b: 17556799564.3608 },
          { a: 1341100800000.0, b: 15072335530.1469 },
          { a: 1349049600000.0, b: 16144558733.3479 },
          { a: 1356998400000.0, b: 17240438150.8705 },
          { a: 1364774400000.0, b: 19846750643.2005 },
          { a: 1372636800000.0, b: 20632760213.203 },
          { a: 1380585600000.0, b: 23564210923.732 },
          { a: 1388534400000.0, b: 23496114802.6306 },
          { a: 1396310400000.0, b: 24929023814.3907 },
          { a: 1404172800000.0, b: 28238946924.7842 },
          { a: 1412121600000.0, b: 27414399344.8086 },
          { a: 1420070400000.0, b: 31217170155.594 },
          { a: 1427846400000.0, b: 31933703681.3394 },
          { a: 1435708800000.0, b: 32511831601.7974 },
          { a: 1443657600000.0, b: 34083939365.3269 },
          { a: 1451606400000.0, b: 32687075889.8431 },
          { a: 1459468800000.0, b: 35283324757.5248 },
          { a: 1467331200000.0, b: 33602251631.1344 },
          { a: 1475280000000.0, b: 29242213836.183 },
          { a: 1483228800000.0, b: 27034460463.7187 },
          { a: 1491004800000.0, b: 22891637782.7125 },
          { a: 1498867200000.0, b: 19425099918.174 },
          { a: 1506816000000.0, b: 20063791015.7993 },
          { a: 1514764800000.0, b: 23134024669.1298 },
          { a: 1522540800000.0, b: 21081804472.0876 },
          { a: 1530403200000.0, b: 21063739483.3645 },
        ],
      },
      {
        dataType: 'VO2',
        currency: 'USD',
        currencySymbol: '$',
        name: 'Boston Office Volume ($)',
        ticker: 'BOSMET_OFF',
        lookupname: 'Boston Office Volume ($)',
        fullName: 'Boston Office Volume ($).VO2.USD',
        type: 'line',
        yAxis: 0,
        color: '#2567ab',
        dashStyle: 'Solid',
        symbol: 'circle',
        values: [
          { a: 1009843200000.0, b: 1741589638.6379 },
          { a: 1017619200000.0, b: 879255598.6667 },
          { a: 1025481600000.0, b: 992932988.6667 },
          { a: 1033430400000.0, b: 1648611545.0 },
          { a: 1041379200000.0, b: 2708631462.9867 },
          { a: 1049155200000.0, b: 2435460052.32 },
          { a: 1057017600000.0, b: 2482879324.7599 },
          { a: 1064966400000.0, b: 1719042540.4266 },
          { a: 1072915200000.0, b: 2015622076.8499 },
          { a: 1080777600000.0, b: 2640848508.7685 },
          { a: 1088640000000.0, b: 3072943754.9954 },
          { a: 1096588800000.0, b: 4037940655.2354 },
          { a: 1104537600000.0, b: 4255651955.8254 },
          { a: 1112313600000.0, b: 4796089187.5605 },
          { a: 1120176000000.0, b: 4340463488.1983 },
          { a: 1128124800000.0, b: 4718944558.1338 },
          { a: 1136073600000.0, b: 4088673884.4382 },
          { a: 1143849600000.0, b: 4556940571.1179 },
          { a: 1151712000000.0, b: 6520576856.3005 },
          { a: 1159660800000.0, b: 10993479561.2499 },
          { a: 1167609600000.0, b: 16872337618.3561 },
          { a: 1175385600000.0, b: 16813584797.3809 },
          { a: 1183248000000.0, b: 15556320802.8937 },
          { a: 1191196800000.0, b: 11031540916.0143 },
          { a: 1199145600000.0, b: 4334640504.1782 },
          { a: 1207008000000.0, b: 3157340894.9513 },
          { a: 1214870400000.0, b: 2732867810.9513 },
          { a: 1222819200000.0, b: 1628277272.7058 },
          { a: 1230768000000.0, b: 1754845336.1313 },
          { a: 1238544000000.0, b: 1359048598.9999 },
          { a: 1246406400000.0, b: 913679682.9999 },
          { a: 1254355200000.0, b: 729754682.9999 },
          { a: 1262304000000.0, b: 908560789.6886 },
          { a: 1270080000000.0, b: 1308658300.5923 },
          { a: 1277942400000.0, b: 1284546166.5923 },
          { a: 1285891200000.0, b: 2334873108.5923 },
          { a: 1293840000000.0, b: 2615459162.6294 },
          { a: 1301616000000.0, b: 2389206714.7258 },
          { a: 1309478400000.0, b: 3222577297.7259 },
          { a: 1317427200000.0, b: 3090979411.9458 },
          { a: 1325376000000.0, b: 3310717701.4252 },
          { a: 1333238400000.0, b: 3450522455.4252 },
          { a: 1341100800000.0, b: 3093025735.6735 },
          { a: 1349049600000.0, b: 2784109522.417 },
          { a: 1356998400000.0, b: 2453822942.3428 },
          { a: 1364774400000.0, b: 3039017726.3428 },
          { a: 1372636800000.0, b: 3342603497.0944 },
          { a: 1380585600000.0, b: 5003666082.5816 },
          { a: 1388534400000.0, b: 5564739709.073 },
          { a: 1396310400000.0, b: 6513996825.073 },
          { a: 1404172800000.0, b: 9426715753.013 },
          { a: 1412121600000.0, b: 9426809346.7245 },
          { a: 1420070400000.0, b: 9637364114.2265 },
          { a: 1427846400000.0, b: 9735448923.9298 },
          { a: 1435708800000.0, b: 7251765361.1565 },
          { a: 1443657600000.0, b: 8489880418.0077 },
          { a: 1451606400000.0, b: 10128808012.5014 },
          { a: 1459468800000.0, b: 9839446197.7981 },
          { a: 1467331200000.0, b: 9650253814.9648 },
          { a: 1475280000000.0, b: 7904259308.3182 },
          { a: 1483228800000.0, b: 8514559095.7001 },
          { a: 1491004800000.0, b: 9225830778.6333 },
          { a: 1498867200000.0, b: 9013811225.3039 },
          { a: 1506816000000.0, b: 8151480748.3689 },
          { a: 1514764800000.0, b: 5308924962.6711 },
          { a: 1522540800000.0, b: 4740277854.6509 },
          { a: 1530403200000.0, b: 3911845888.7809 },
        ],
      },
      {
        dataType: 'VO2',
        currency: 'USD',
        currencySymbol: '$',
        name: 'SF Metro Office Volume ($)',
        ticker: 'SFRMET_OFF',
        lookupname: 'SF Metro Office Volume ($)',
        fullName: 'SF Metro Office Volume ($).VO2.USD',
        type: 'line',
        yAxis: 0,
        color: '#00AEEF',
        dashStyle: 'Solid',
        symbol: 'circle',
        values: [
          { a: 1009843200000.0, b: 3044742951.2285 },
          { a: 1017619200000.0, b: 1570593526.1075 },
          { a: 1025481600000.0, b: 1593542588.9688 },
          { a: 1033430400000.0, b: 1374501507.0142 },
          { a: 1041379200000.0, b: 1593997339.622 },
          { a: 1049155200000.0, b: 1683075332.9338 },
          { a: 1057017600000.0, b: 1787783890.8538 },
          { a: 1064966400000.0, b: 2413262062.8557 },
          { a: 1072915200000.0, b: 2280436740.1894 },
          { a: 1080777600000.0, b: 2704210382.5753 },
          { a: 1088640000000.0, b: 3833883066.4218 },
          { a: 1096588800000.0, b: 4687459197.7299 },
          { a: 1104537600000.0, b: 6425039599.2184 },
          { a: 1112313600000.0, b: 8383639038.0089 },
          { a: 1120176000000.0, b: 9840265137.3815 },
          { a: 1128124800000.0, b: 10711572288.9738 },
          { a: 1136073600000.0, b: 11729994710.5149 },
          { a: 1143849600000.0, b: 11717382664.4818 },
          { a: 1151712000000.0, b: 12353726316.2221 },
          { a: 1159660800000.0, b: 12940489971.8963 },
          { a: 1167609600000.0, b: 17204177798.3066 },
          { a: 1175385600000.0, b: 22957951326.919 },
          { a: 1183248000000.0, b: 23042601020.6123 },
          { a: 1191196800000.0, b: 21453772376.7025 },
          { a: 1199145600000.0, b: 15897717317.9593 },
          { a: 1207008000000.0, b: 7909531224.2269 },
          { a: 1214870400000.0, b: 4430006037.6542 },
          { a: 1222819200000.0, b: 3555246981.4875 },
          { a: 1230768000000.0, b: 2083549261.2793 },
          { a: 1238544000000.0, b: 1517450906.2949 },
          { a: 1246406400000.0, b: 1555642882.2949 },
          { a: 1254355200000.0, b: 1312315305.5891 },
          { a: 1262304000000.0, b: 1337328777.0948 },
          { a: 1270080000000.0, b: 2582456181.6309 },
          { a: 1277942400000.0, b: 3127300849.3034 },
          { a: 1285891200000.0, b: 4630297103.5595 },
          { a: 1293840000000.0, b: 5204395036.3769 },
          { a: 1301616000000.0, b: 5477940841.4763 },
          { a: 1309478400000.0, b: 5712473821.1058 },
          { a: 1317427200000.0, b: 5470422899.7221 },
          { a: 1325376000000.0, b: 5682188705.9537 },
          { a: 1333238400000.0, b: 6648852098.39 },
          { a: 1341100800000.0, b: 7431394458.088 },
          { a: 1349049600000.0, b: 9965189566.5115 },
          { a: 1356998400000.0, b: 9715209791.6235 },
          { a: 1364774400000.0, b: 8712081395.1654 },
          { a: 1372636800000.0, b: 8034495126.1654 },
          { a: 1380585600000.0, b: 7758583836.7111 },
          { a: 1388534400000.0, b: 9984241222.1228 },
          { a: 1396310400000.0, b: 12426529530.4951 },
          { a: 1404172800000.0, b: 15403752617.5097 },
          { a: 1412121600000.0, b: 15527642791.042 },
          { a: 1420070400000.0, b: 19018497475.9382 },
          { a: 1427846400000.0, b: 17441999746.242 },
          { a: 1435708800000.0, b: 16746295966.0608 },
          { a: 1443657600000.0, b: 16384090898.8927 },
          { a: 1451606400000.0, b: 12304516871.9294 },
          { a: 1459468800000.0, b: 13081308276.0265 },
          { a: 1467331200000.0, b: 13645970399.268 },
          { a: 1475280000000.0, b: 14727509534.7871 },
          { a: 1483228800000.0, b: 15658228307.1536 },
          { a: 1491004800000.0, b: 15163952198.7418 },
          { a: 1498867200000.0, b: 14697835363.6699 },
          { a: 1506816000000.0, b: 12702035384.5502 },
          { a: 1514764800000.0, b: 10964867394.9894 },
          { a: 1522540800000.0, b: 11498469784.498 },
          { a: 1530403200000.0, b: 8719759475.495 },
        ],
      },
    ];

    return (
      <article>
        <Helmet>
          <title>Home</title>
          <meta name="description" content="TrendTracker" />
        </Helmet>
        <div>
          <Section>
            <LineBarChart data={data} />
            {/* <Form onSubmit={this.props.onSubmitForm}>
              <label htmlFor="username">
                <FormattedMessage {...messages.trymeMessage} />
                <AtPrefix>
                  <FormattedMessage {...messages.trymeAtPrefix} />
                </AtPrefix>
                <Input
                  id="username"
                  type="text"
                  placeholder="mxstbr"
                  value={this.props.username}
                  onChange={this.props.onChangeUsername}
                />
              </label>
            </Form>
            <ReposList {...reposListProps} /> */}
          </Section>
        </div>
      </article>
    );
  }
}

HomePage.propTypes = {
  loading: PropTypes.bool,
  error: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),
  repos: PropTypes.oneOfType([PropTypes.array, PropTypes.bool]),
  onSubmitForm: PropTypes.func,
  username: PropTypes.string,
  onChangeUsername: PropTypes.func,
};

export function mapDispatchToProps(dispatch) {
  return {
    onChangeUsername: evt => dispatch(changeUsername(evt.target.value)),
    onSubmitForm: evt => {
      if (evt !== undefined && evt.preventDefault) evt.preventDefault();
      dispatch(loadRepos());
    },
  };
}

const mapStateToProps = createStructuredSelector({
  repos: makeSelectRepos(),
  username: makeSelectUsername(),
  loading: makeSelectLoading(),
  error: makeSelectError(),
});

const withConnect = connect(
  mapStateToProps,
  mapDispatchToProps,
);

const withReducer = injectReducer({ key: 'home', reducer });
const withSaga = injectSaga({ key: 'home', saga });

export default compose(
  withReducer,
  withSaga,
  withConnect,
)(HomePage);
